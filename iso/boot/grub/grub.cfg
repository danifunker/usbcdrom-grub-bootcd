# GRUB2 Boot Configuration - Minimalist approach for maximum compatibility
# Specifically designed to avoid disk scanning errors

# Immediately disable all disk scanning
set GRUB_DISABLE_DISK_SCAN=true
insmod part_msdos
insmod fat
insmod iso9660
insmod normal

# CRITICAL: Override GRUB's disk scanning behavior
function grub_probe { true; }
export grub_probe

# Set static values - don't try to auto-detect anything
set root=cd0
set prefix=(cd0)/boot/grub
set image_dir=(cd0)/images

# Basic configuration
set timeout=10
set default=0

# Load menu display capability without error checking
# (error checking can trigger disk scanning)
normal

menuentry "Diagnostic Tools" {
  echo "=== GRUB VARIABLES ==="
  echo "Root: ${root}"
  echo "Prefix: ${prefix}"
  echo "Image dir: ${image_dir}"
  echo ""
  
  echo "=== AVAILABLE DEVICES ==="
  ls
  echo ""
  
  echo "=== FILE STRUCTURE ==="
  echo "Root directory:"
  ls /
  echo "Boot directory:"
  ls /boot || true
  echo ""
  
  echo "Press any key to continue..."
  sleep -i 30
}

menuentry "Boot Windows 98 with USB CDROM Support" {
  echo "Loading Windows 98 boot image..."
  linux16 /boot/memdisk
  initrd16 /images/w98_boot.img
}

menuentry "Boot MSDOS 6.22 with USB CDROM" {
  echo "Loading MS-DOS 6.22 image..."
  linux16 /boot/memdisk
  initrd16 /images/msdos622-with-usbcdrom.img
}

menuentry "Boot from first hard disk" {
  echo "Booting from first hard disk..."
  chainloader (hd0)+1
}
