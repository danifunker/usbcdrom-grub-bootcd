# GRUB2 Boot Configuration for USBHLPCD - Maximum Compatibility
# Optimized for IDE-connected drives in BIOS systems

# Basic configuration
set timeout=10
set default=0

# Add some visual styling
set menu_color_normal=white/black
set menu_color_highlight=black/light-gray

# Limit disk scan to prevent "disk not found" errors
set bios_boot=1

# Preload core modules with error suppression
insmod all_video || true
insmod ata || true
insmod biosdisk || true
insmod pata || true
insmod part_msdos || true
insmod fat || true
insmod iso9660 || true
insmod normal || true
insmod search || true
insmod ls || true
insmod linux || true
insmod linux16 || true
insmod chain || true
insmod boot || true
insmod configfile || true
insmod echo || true
insmod sleep || true

# USB support modules
insmod usb || true
insmod uhci || true
insmod ohci || true
insmod ehci || true
insmod usbms || true

# Now that all modules are loaded, try to find our device by filesystem label
search --no-floppy --label USBHLPCD --set=boot
set prefix=($boot)/boot/grub
export boot
export prefix

menuentry "Boot USB CD-ROM" {
  linux16 /boot/memdisk iso raw
  initrd16 (usb0)
}

menuentry "Boot from Windows 98 Floppy Image with USB CDROM Support" {
  # Load the memdisk module
  insmod memdisk
  
  # Boot from the floppy image
  linux16 /boot/memdisk
  initrd16 /images/w98_boot.img
}

menuentry "Boot MSDOS 6.22 Basic Floppy Image (no setup.bat)" {
  # Load the memdisk module
  insmod memdisk
  
  # Boot from the floppy image
  linux16 /boot/memdisk
  initrd16 /images/msdos622-with-usbcdrom.img
}

# Add a fallback option
menuentry "Boot from first hard disk" {
  insmod chain
  insmod part_gpt
  chainloader (hd0,1)+1
}