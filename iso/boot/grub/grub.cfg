# GRUB2 Boot Configuration for USBHLPCD - Simple Compatibility Version
# Optimized for IDE-connected drives in BIOS systems

# Set basic variables explicitly
set root=cd0
set prefix=(cd0)/boot/grub

# Basic configuration
set timeout=10
set default=0

# Add some visual styling
set menu_color_normal=white/black
set menu_color_highlight=black/light-gray

# Load essential modules (simplified syntax)
insmod ata
insmod biosdisk
insmod pata
insmod part_msdos
insmod fat
insmod iso9660
insmod normal
insmod search
insmod ls
insmod linux
insmod linux16
insmod chain
insmod boot
insmod configfile
insmod echo
insmod sleep

# USB support modules
insmod usb
insmod uhci
insmod ohci
insmod ehci
insmod usbms

# Try to find our device by filesystem label
search --no-floppy --label USBHLPCD --set=found_root

# Apply the search results if found
if test -n "${found_root}"; then
  set root=${found_root}
  set prefix=(${found_root})/boot/grub
fi

# This is critical - explicitly load the normal module to show the menu
normal

# If we get here, normal failed - try to load the menu directly
configfile ${prefix}/grub.cfg

# Diagnostic menu entry with simplified syntax
menuentry "List Devices and Files" {
  echo "Available devices:"
  ls
  echo "Files in root:"
  ls /
  echo "Boot directory:"
  ls /boot
  echo "GRUB directory:"
  ls /boot/grub
  echo "Prefix: ${prefix}"
  echo "Root: ${root}"
  echo "Press ESC to return to menu"
  sleep 30
}

menuentry "Boot from Windows 98 Floppy Image with USB CDROM Support" {
  echo "Loading Windows 98 boot image..."
  linux16 /boot/memdisk
  initrd16 /images/w98_boot.img
}

menuentry "Boot MSDOS 6.22 Basic Floppy Image" {
  echo "Loading MS-DOS 6.22 image..."
  linux16 /boot/memdisk
  initrd16 /images/msdos622-with-usbcdrom.img
}

menuentry "Boot from first hard disk" {
  echo "Attempting to boot from first hard disk..."
  chainloader (hd0)+1
}

